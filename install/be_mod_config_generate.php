<?php function module_config_generate ($step) { $step['arguments']=base64_decode($step['arguments']);$step['arguments']=unserialize($step['arguments']);if (!isset($_POST['config_generate']) and !isset($_REQUEST['download'])) { $temp=@fopen('temp_config.php','w') or die(_5('temp_config.php is not writeable.  Please CHMOD this install directory to 777 and Refresh.'));fclose($temp);$_20.='</form><form method="post" action="index.php"><table>';while (list(,$data)=each($step['arguments']['fields'])) { switch ($data['type']) { case 'text':$_20.='<tr><td valign="top"><b>'.$data['name'].'</b><br />'.$data['help'].'</td><td><input type="text" width="55" value="'.$data['default'].'" name="'.strtolower(strip_tags(str_replace(' ','',$data['name']))).'" /></td></tr>';break;case 'password': $_20 .= '<tr><td valign="top"><b>' . $data['name'] . '</b><br />' . $data['help'] . '</td><td><input type="password" width="55" value="' . $data['default'] . '" name="' . strtolower(strip_tags(str_replace(' ','',$data['name']))) . '" /></td></tr>';break;case 'textarea':$_20.='<tr><td valign="top"><b>'.$data['name'].'</b><br />'.$data['help'].'</td><td><textarea width="55" height="20" name="'.strtolower(strip_tags(str_replace(' ','',$data['name']))).'">'.$data['default'].'</textarea></td></tr>';break;} } $_20.='<input type="hidden" name="config_generate" value="1" /></table>';return array( 'description'=> $_20,'processtext'=> 'Generate Configuration File','processurl'=> $step['number'],'processdisabled'=> FALSE );} elseif (!isset($_REQUEST['download'])) { $template=stripslashes(stripslashes(stripslashes($step['arguments']['template'])));$temp=@fopen('temp_config.php','w') or die(_5('temp_config.php is not writeable.Please CHMOD this install directory to 777 and Refresh.'));fwrite($temp,'<?php'."\n\n");while (list(,$data)=each($step['arguments']['fields'])) { $template=str_replace('{field_'.$data['name'].'}',$_POST[strtolower(strip_tags(str_replace(' ','',$data['name'])))],$template);fwrite($temp,'$temp_config[\''.$data['name'].'\']=\''.$_POST[strtolower(strip_tags(str_replace(' ','',$data['name'])))].'\';'."\n");} fwrite($temp,"\n?>");fclose($temp);$template=base64_encode($template);if ($config=@fopen($step['arguments']['directory'].$step['arguments']['filename'],'w')) { fwrite($config,base64_decode($template));fclose($config);$_20='Your Configuration File has automatically been uploaded to the correct location of your web site.';return array( 'description'=> $_20,'descriptionoverwrite'=> TRUE,'processtext'=> FALSE,'processurl'=> FALSE,'processdisabled'=> FALSE );} $_20.='</form><form method="post" action="'.$PHP_SELF.'"><input type="hidden" name="step" value="'.$step['number'].'" /><input type="hidden" name="download" value="1" /><input type="hidden" name="file" value="'.$template.'"><input type="submit" name="submit" value="Download Configuration File" /></form><form method="post" action="'.$PHP_SELF.'"><br /><br />'.$step['arguments']['uploadinstructions'];return array( 'description'=> $_20,'descriptionoverwrite'=> TRUE,'processtext'=> FALSE,'processurl'=> FALSE,'processdisabled'=> FALSE );} else { header("Cache-Control:no-cache,must-revalidate");header("Pragma:no-cache");header("Content-type:application/octet-stream");header("Content-Disposition:attachment;filename=".$step['arguments']['filename']);echo base64_decode($_POST['file']);exit();} }
