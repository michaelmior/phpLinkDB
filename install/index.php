<?php require "be_config.php";$_0='NAME';$_1='DESCRIPTION';$_2='TYPE';$_3='ARGUMENTS';$_4='EXTRA';$_5='STEP';$_6="";$_7="";$_8="";$_9="";$_A="";$_B=false;$filename='buildexec.xml';$_D=xml_parser_create();xml_set_element_handler($_D,"startElement","endElement");xml_set_character_data_handler($_D,"characterData");$_E=fopen($filename,"r");while ($data=fread($_E,4096)) { xml_parse($_D,$data,feof($_E)) or die(sprintf("XML error:%s at line %d",xml_error_string(xml_get_error_code($_D)),xml_get_current_line_number($_D)));} fclose($_E);xml_parser_free($_D);function startElement($_10,$name,$_12) { global $_5,$_0,$_1,$_2,$_3,$_4,$_6,$_7,$_8,$_9,$_A,$_B,$_13;if ($_B) { $_13=$name;} elseif ($name==$_5) { $_B=true;} } function endElement($_10,$name) { global $_5,$_0,$_1,$_2,$_3,$_4,$_6,$_7,$_8,$_9,$_A,$_B,$_13;if ($name==$_5) { $_14=array( $_0=> $_6,$_1=> $_7,$_2=> $_8,$_3=> $_9,$_4=> $_A );$GLOBALS["_15"][]=$_14;unset($_14);$_6="";$_7="";$_8="";$_9="";$_A="";$_B=false;} } function characterData($_10,$data) { global $_5,$_0,$_1,$_2,$_3,$_4,$_6,$_7,$_8,$_9,$_A,$_B,$_13;if ($_B) { switch ($_13) { case $_0:$_6.=$data;break;case $_1:$_7.=$data;break;case $_2:$_8.=$data;break;case $_3:$_9.=$data;break;case $_4:$_A.=$data;break;} } } $_16=$GLOBALS["_15"];if (isset($_REQUEST['step'])) { if (substr($_REQUEST['step'],0,3)=='url') { header("Location:".str_replace('url:','',$_REQUEST['step']));} else { _3($_REQUEST['step']);} } else { _3('-1');} function _3 ($step_id) { global $config,$_16;if ($step_id=='-1') { $step['name']=$config['name'].' Installation';$step['description']=nl2br($config['welcome']);$step['results']['processdisabled']=FALSE;$step['results']['processtext']='Begin Installation';$step['results']['processurl']='0';echo _4($step);return TRUE;} if (count($_16) < ($step_id+1)) { $step['name']='Installation Complete';$step['description']=nl2br($config['installfinished']);$step['results']['processdisabled']=TRUE;$step['results']['processtext']='Installation Complete';echo _4($step);return TRUE;} $step['number']=$step_id;$step['name']=$_16[$step_id]['NAME'];$step['description']=$_16[$step_id]['DESCRIPTION'];$step['type']=trim($_16[$step_id]['TYPE']);$step['arguments']=$_16[$step_id]['ARGUMENTS'];$step['extra']=$_16[$step_id]['EXTRA'];require("be_mod_".$step['type'].".php");$function='module_'.$step['type'];$step['results']=$function($step);if ($step['results']['descriptionoverwrite'] !=TRUE) { $step['description']=nl2br($step['description'].'<br /><br />'.$step['results']['description']);} else { $step['description']=nl2br($step['results']['description']);} if ($step['results']['processurl']==FALSE and count($_16)==($step_id+1)) { $step['results']['processtext']='Finish Installation';} echo _4($step);return TRUE;} function _4 ($_1B) { global $config;$template=file_get_contents('be_template.tmpl');while (list($name,$_1D)=each($config)) { $template=str_replace('{config_'.strtoupper($name).'}',$_1D,$template);} $template=str_replace('{step_NAME}',$_1B['name'],$template);$template=str_replace('{step_DESCRIPTION}',$_1B['description'],$template);if ($_1B['results']['processdisabled']==TRUE) { $template=str_replace('{process_DISABLED}','disabled="disabled"',$template);} else { $template=str_replace('{process_DISABLED}','',$template);} if ($_1B['results']['processtext']==FALSE) { $template=str_replace('{process_TEXT}','Proceed with Installation',$template);} else { $template=str_replace('{process_TEXT}',$_1B['results']['processtext'],$template);} if ($_1B['results']['processurl']==FALSE and $_1B['results']['processurl'] !=="0") { $template=str_replace('{process_URL}',$_REQUEST['step']+1,$template);} else { $template=str_replace('{process_URL}',$_1B['results']['processurl'],$template);} return $template;} function _5 ($_1E) { global $config;mail($config['reportemail'],$config['name'].' '.$config['version'].' Installation Error',"The error displayed to the user was:\n\n\"".$_1E."\"\n\nURL:http://".$_SERVER['HTTP_HOST'].$_SERVER['PHP_SELF'].'?'.$_SERVER['QUERY_STRING']."\n\n--BuildExec PHP Installer","From:BuildExec <buildexec@".$_SERVER['HTTP_HOST'].">");$step=array( 'name'=> 'Error','description'=> $_1E,'results'=> array( 'processdisabled'=> FALSE,'processurl'=> $_REQUEST['step'],'processtext'=> 'Click Here to Refresh' ) );echo _4($step);} ?>
